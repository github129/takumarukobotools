<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Apps SVG Icon Embedder - Material Icons for Power Apps</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Google Material IconsをPower Appsで簡単に使えるSVG埋め込みツール。アイコンを選択するだけでPower Apps用の式を自動生成してコピーできます。">
    <meta name="keywords" content="Power Apps, SVG, Material Icons, Google Icons, アイコン, 埋め込み, Microsoft">
    <meta name="author" content="takumarukobotools">
    <meta name="robots" content="index, follow">
    <meta name="language" content="ja">

    <!-- Open Graph Tags -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Power Apps SVG Icon Embedder - Material Icons for Power Apps">
    <meta property="og:description" content="Google Material IconsをPower Appsで簡単に使えるSVG埋め込みツール">
    <meta property="og:url" content="https://takumarukobotools.github.io/power-apps-svg-icon-embedder/">
    <meta property="og:site_name" content="Takumaru Kobo Tools">
    <meta property="og:locale" content="ja_JP">

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Power Apps SVG Icon Embedder">
    <meta name="twitter:description" content="Google Material IconsをPower Appsで簡単に使えるSVG埋め込みツール">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
    <link rel="canonical" href="https://takumarukobotools.github.io/power-apps-svg-icon-embedder/">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Power Apps SVG Icon Embedder",
        "applicationCategory": "DesignApplication",
        "description": "Google Material IconsをPower Appsで簡単に使えるSVG埋め込みツール。アイコンを選択するだけでPower Apps用の式を自動生成してコピーできます。",
        "url": "https://takumarukobotools.github.io/power-apps-svg-icon-embedder/",
        "author": {
            "@type": "Organization",
            "name": "Takumaru Kobo"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "JPY"
        },
        "operatingSystem": "Web Browser",
        "softwareVersion": "2.0",
        "inLanguage": "ja",
        "isAccessibleForFree": true,
        "keywords": ["Power Apps", "SVG", "Material Icons", "Google Icons", "アイコン"]
    }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <style>
        .material-symbols-outlined.filled { font-variation-settings: 'FILL' 1; }
        .material-symbols-rounded.filled { font-variation-settings: 'FILL' 1; }
        .material-symbols-sharp.filled { font-variation-settings: 'FILL' 1; }
    </style>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333333;
            height: 100vh;
            overflow: hidden;
        }

        .header {
            background: #ffffff;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            flex-wrap: wrap;
            gap: 10px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            font-size: 18px;
            font-weight: 700;
            color: #333333;
        }

        .header-right {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .icon-btn {
            padding: 8px 16px;
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #333333;
            transition: background 0.2s;
            font-weight: 500;
        }

        .icon-btn:hover {
            background: #f5f5f5;
        }

        .icon-btn.primary {
            background: #667eea;
            color: #ffffff;
            border: none;
        }

        .icon-btn.primary:hover {
            background: #5568d3;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 60px);
            overflow: hidden;
        }

        .sidebar {
            width: 320px;
            background: #ffffff;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            padding: 20px;
        }

        .search-box {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 20px;
            transition: border-color 0.2s;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
        }

        .category-section {
            margin-bottom: 20px;
        }

        .category-title {
            font-size: 13px;
            font-weight: 600;
            color: #666666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
            padding: 8px;
            overflow-y: auto;
            height: calc(100vh - 60px);
            flex: 1;
        }

        .icon-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px 8px;
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 100px;
        }

        .icon-item:hover {
            border-color: #667eea;
            background: #f9f9ff;
        }

        .icon-item.selected {
            border-color: #667eea;
            background: #667eea;
            color: #ffffff;
        }

        .icon-item .material-symbols-outlined,
        .icon-item .material-symbols-rounded,
        .icon-item .material-symbols-sharp {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .icon-item.selected .material-symbols-outlined,
        .icon-item.selected .material-symbols-rounded,
        .icon-item.selected .material-symbols-sharp {
            color: #ffffff;
        }

        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-smoothing: antialiased;
        }

        .material-symbols-rounded {
            font-family: 'Material Symbols Rounded';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-smoothing: antialiased;
        }

        .material-symbols-sharp {
            font-family: 'Material Symbols Sharp';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-smoothing: antialiased;
        }

        .icon-name {
            font-size: 11px;
            text-align: center;
            word-break: break-word;
            line-height: 1.3;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #ffffff;
            border-radius: 8px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: #333333;
            flex: 1;
            min-width: 200px;
        }

        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: #999999;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .close-btn:hover {
            background: #f5f5f5;
            color: #333333;
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            max-height: calc(85vh - 140px);
        }

        .preview-container {
            background: #f9f9ff;
            border-radius: 4px;
            padding: 40px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
        }

        .preview-icon {
            width: 120px;
            height: 120px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-label {
            font-size: 13px;
            font-weight: 600;
            color: #666666;
            margin-bottom: 8px;
            display: block;
        }

        .color-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .color-input {
            width: 60px;
            height: 40px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
        }

        .color-text {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 13px;
            font-family: monospace;
        }

        .gradient-type {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .gradient-btn {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            background: #ffffff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .gradient-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: #ffffff;
            font-weight: 600;
        }

        .code-container {
            background: #f8f8f8;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 16px;
            margin-bottom: 16px;
            position: relative;
        }

        .code-label {
            font-size: 12px;
            font-weight: 600;
            color: #666666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .code-content {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #333333;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }

        .copy-btn {
            margin-top: 12px;
            width: 100%;
            padding: 10px;
            background: #667eea;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #5568d3;
        }

        .copy-btn.copied {
            background: #10b981;
        }

        .header-copy-btn {
            padding: 8px 16px;
            background: #667eea;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .header-copy-btn:hover {
            background: #5568d3;
        }

        .header-copy-btn.copied {
            background: #10b981;
        }

        .header-copy-btn.theme {
            background: #10b981;
        }

        .header-copy-btn.theme:hover {
            background: #059669;
        }

        .menu-toggle {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 999;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .menu-toggle:hover {
            background: #5568d3;
        }

        .menu-toggle:active {
            transform: scale(0.95);
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
        }

        @media (max-width: 768px) {
            .menu-toggle {
                display: flex;
            }

            .sidebar-overlay.show {
                display: block;
            }

            .sidebar {
                position: fixed;
                left: 0;
                top: 60px;
                width: 85%;
                max-width: 320px;
                height: calc(100vh - 60px);
                transform: translateX(-100%);
                z-index: 999;
                transition: transform 0.3s ease;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .icon-grid {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                padding-bottom: 100px;
            }

            .modal-header {
                padding: 16px;
            }

            .modal-title {
                width: 100%;
                order: -1;
                margin-bottom: 8px;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .header-copy-btn {
                flex: 1;
                font-size: 12px;
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <div class="logo">Power Apps SVG Icon Embedder</div>
        </div>
        <div class="header-right">
            <button class="icon-btn" onclick="showHelp()">
                <span>使い方</span>
            </button>
            <button class="icon-btn" onclick="window.location.href='../'">
                <span>ホームに戻る</span>
            </button>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar" id="sidebar">
            <input type="text" class="search-box" id="searchBox" placeholder="アイコンを検索..." onkeyup="filterIcons()">

            <div class="category-section">
                <div class="category-title">アイコンスタイル</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;">
                    <button class="gradient-btn active" data-style="outlined" onclick="setIconStyle('outlined')">Outlined</button>
                    <button class="gradient-btn" data-style="rounded" onclick="setIconStyle('rounded')">Rounded</button>
                    <button class="gradient-btn" data-style="sharp" onclick="setIconStyle('sharp')">Sharp</button>
                    <button class="gradient-btn" data-style="filled" onclick="setIconStyle('filled')">Filled</button>
                </div>
            </div>

            <div class="category-section">
                <div class="category-title">使い方</div>
                <p style="font-size: 13px; color: #666; line-height: 1.6;">
                    アイコンをクリックして選択し、色やグラデーションを設定してPower Apps用のSVG式をコピーできます。
                </p>
            </div>
        </div>

        <div class="icon-grid" id="iconGrid">
            <!-- Icons will be populated here -->
        </div>
    </div>

    <!-- Floating Menu Button for Mobile -->
    <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>

    <!-- Code Modal -->
    <div class="modal" id="codeModal" onclick="closeCodeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">アイコンカスタマイズ</div>
                <div class="header-actions">
                    <button class="header-copy-btn" id="headerCopySvgBtn" onclick="copySvgCode()">コピー</button>
                    <button class="header-copy-btn theme" id="headerCopySvgThemeBtn" onclick="copySvgCodeWithThemeColor()">テーマ色</button>
                    <button class="close-btn" onclick="closeCodeModal()">×</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="preview-container" id="previewContainer">
                    <svg id="previewIcon" class="preview-icon" viewBox="0 -960 960 960" width="120" height="120">
                        <path id="previewPath" d=""/>
                    </svg>
                </div>

                <div class="control-group">
                    <label class="control-label">塗りタイプ</label>
                    <div class="gradient-type">
                        <button class="gradient-btn active" data-type="solid" onclick="setFillType('solid')">単色</button>
                        <button class="gradient-btn" data-type="linear" onclick="setFillType('linear')">線形グラデーション</button>
                        <button class="gradient-btn" data-type="radial" onclick="setFillType('radial')">円形グラデーション</button>
                    </div>
                </div>

                <div class="control-group" id="solidColorGroup">
                    <label class="control-label">色</label>
                    <div class="color-input-group">
                        <input type="color" class="color-input" id="solidColor" value="#333333" onchange="updatePreview()">
                        <input type="text" class="color-text" id="solidColorText" value="#333333" oninput="updateSolidColorFromText()">
                    </div>
                </div>

                <div class="control-group" id="gradientColorGroup" style="display: none;">
                    <label class="control-label">グラデーション開始色</label>
                    <div class="color-input-group">
                        <input type="color" class="color-input" id="gradientColor1" value="#667eea" onchange="updateGradientColor1FromPicker()">
                        <input type="text" class="color-text" id="gradientColor1Text" value="#667eea" oninput="updateGradientColor1FromText()">
                    </div>
                </div>

                <div class="control-group" id="gradientColorGroup2" style="display: none;">
                    <label class="control-label">グラデーション終了色</label>
                    <div class="color-input-group">
                        <input type="color" class="color-input" id="gradientColor2" value="#764ba2" onchange="updateGradientColor2FromPicker()">
                        <input type="text" class="color-text" id="gradientColor2Text" value="#764ba2" oninput="updateGradientColor2FromText()">
                    </div>
                </div>

                <div class="control-group" id="linearDirectionGroup" style="display: none;">
                    <label class="control-label">グラデーション方向</label>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                        <button class="gradient-btn" data-direction="to-bottom" onclick="setLinearDirection('to-bottom')">↓ 上→下</button>
                        <button class="gradient-btn" data-direction="to-top" onclick="setLinearDirection('to-top')">↑ 下→上</button>
                        <button class="gradient-btn" data-direction="to-right" onclick="setLinearDirection('to-right')">→ 左→右</button>
                        <button class="gradient-btn" data-direction="to-left" onclick="setLinearDirection('to-left')">← 右→左</button>
                        <button class="gradient-btn active" data-direction="diagonal-br" onclick="setLinearDirection('diagonal-br')">↘ 対角1</button>
                        <button class="gradient-btn" data-direction="diagonal-bl" onclick="setLinearDirection('diagonal-bl')">↙ 対角2</button>
                        <button class="gradient-btn" data-direction="diagonal-tr" onclick="setLinearDirection('diagonal-tr')">↗ 対角3</button>
                        <button class="gradient-btn" data-direction="diagonal-tl" onclick="setLinearDirection('diagonal-tl')">↖ 対角4</button>
                    </div>
                </div>

                <div class="control-group" id="radialTypeGroup" style="display: none;">
                    <label class="control-label">円形グラデーション種類</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button class="gradient-btn active" data-radial="center" onclick="setRadialType('center')">中央</button>
                        <button class="gradient-btn" data-radial="top-left" onclick="setRadialType('top-left')">左上</button>
                        <button class="gradient-btn" data-radial="top-right" onclick="setRadialType('top-right')">右上</button>
                        <button class="gradient-btn" data-radial="bottom-left" onclick="setRadialType('bottom-left')">左下</button>
                        <button class="gradient-btn" data-radial="bottom-right" onclick="setRadialType('bottom-right')">右下</button>
                    </div>
                </div>

                <div class="code-container">
                    <div class="code-label">Power Apps 式（Image コントロールの Image プロパティに設定）</div>
                    <div class="code-content" id="svgCode"></div>
                    <button class="copy-btn" id="copySvgBtn" onclick="copySvgCode()">コピー</button>
                    <button class="copy-btn" id="copySvgThemeBtn" onclick="copySvgCodeWithThemeColor()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); margin-top: 8px;">テーマカラーでコピー</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">使い方ガイド</div>
                <button class="close-btn" onclick="closeHelpModal()">×</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">基本的な使い方</h3>
                    <ol style="font-size: 14px; color: #666; line-height: 1.8; padding-left: 20px;">
                        <li>使いたいアイコンをクリックして選択</li>
                        <li>色やグラデーションをカスタマイズ</li>
                        <li>表示されたPower Apps用のSVG式をコピー</li>
                        <li>Power Appsで Image コントロールを追加</li>
                        <li>Image プロパティに式を貼り付け</li>
                    </ol>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">カラー設定</h3>
                    <ul style="font-size: 14px; color: #666; line-height: 1.8; padding-left: 20px;">
                        <li><strong>単色:</strong> 1色でアイコンを塗りつぶし</li>
                        <li><strong>線形グラデーション:</strong> 上から下へのグラデーション</li>
                        <li><strong>円形グラデーション:</strong> 中心から外側へのグラデーション</li>
                    </ul>
                </div>

                <div>
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">検索機能</h3>
                    <p style="font-size: 14px; color: #666; line-height: 1.6;">
                        左側の検索ボックスにキーワードを入力すると、アイコン名で絞り込みができます。
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Material Icons の全アイコン名リスト（500種類以上）
        const materialIcons = [
            'home', 'search', 'settings', 'favorite', 'account_circle', 'shopping_cart', 'info', 'help',
            'delete', 'add', 'close', 'check', 'arrow_back', 'arrow_forward', 'menu', 'more_vert',
            'star', 'star_border', 'send', 'save', 'edit', 'create', 'done', 'clear',
            'email', 'phone', 'location_on', 'event', 'calendar_today', 'schedule', 'alarm', 'access_time',
            'person', 'people', 'group', 'face', 'badge', 'lock', 'visibility', 'visibility_off',
            'download', 'upload', 'cloud', 'cloud_upload', 'cloud_download', 'attach_file', 'folder', 'insert_drive_file',
            'print', 'share', 'link', 'code', 'build', 'bug_report', 'dashboard', 'analytics',
            'trending_up', 'trending_down', 'bar_chart', 'pie_chart', 'show_chart', 'insert_chart', 'table_chart', 'assessment',
            'notifications', 'notifications_active', 'warning', 'error', 'check_circle', 'cancel', 'report', 'verified',
            'thumb_up', 'thumb_down', 'bookmark', 'bookmark_border', 'flag', 'grade', 'comment', 'chat',
            'refresh', 'sync', 'update', 'cached', 'restore', 'autorenew', 'loop', 'history',
            'zoom_in', 'zoom_out', 'fullscreen', 'fullscreen_exit', 'expand_more', 'expand_less', 'chevron_right', 'chevron_left',
            'shopping_bag', 'local_offer', 'loyalty', 'payment', 'credit_card', 'account_balance', 'monetization_on', 'attach_money',
            'lightbulb', 'power', 'wifi', 'bluetooth', 'battery_full', 'signal_cellular_alt', 'network_wifi', 'devices',
            'camera', 'photo', 'image', 'photo_library', 'collections', 'movie', 'videocam', 'mic',
            'play_arrow', 'pause', 'stop', 'skip_next', 'skip_previous', 'fast_forward', 'fast_rewind', 'volume_up',
            'keyboard', 'mouse', 'desktop_windows', 'laptop', 'phone_iphone', 'tablet', 'watch', 'tv',
            'restaurant', 'local_dining', 'local_cafe', 'local_bar', 'local_pizza', 'cake', 'fastfood', 'lunch_dining',
            'directions_car', 'directions_bus', 'directions_subway', 'flight', 'local_taxi', 'directions_bike', 'directions_walk', 'map',
            'school', 'work', 'business', 'store', 'local_hospital', 'local_pharmacy', 'fitness_center', 'spa',
            'account_box', 'add_box', 'add_circle', 'add_circle_outline', 'apps', 'archive', 'arrow_downward', 'arrow_drop_down',
            'arrow_drop_up', 'arrow_upward', 'backspace', 'block', 'brightness_1', 'broken_image', 'brush', 'bug_report',
            'call', 'call_end', 'call_made', 'call_received', 'card_giftcard', 'card_membership', 'card_travel', 'casino',
            'cast', 'center_focus_strong', 'center_focus_weak', 'chat_bubble', 'chat_bubble_outline', 'check_box', 'check_box_outline_blank',
            'child_care', 'child_friendly', 'chrome_reader_mode', 'class', 'cloud_circle', 'cloud_done', 'cloud_off', 'cloud_queue',
            'color_lens', 'compare', 'compare_arrows', 'computer', 'contact_mail', 'contact_phone', 'contacts', 'content_copy',
            'content_cut', 'content_paste', 'control_point', 'control_point_duplicate', 'copyright', 'create_new_folder', 'crop',
            'crop_free', 'crop_landscape', 'crop_portrait', 'crop_rotate', 'crop_square', 'dashboard', 'data_usage', 'date_range',
            'dehaze', 'description', 'details', 'developer_mode', 'device_hub', 'devices_other', 'dialer_sip', 'dialpad',
            'directions', 'directions_boat', 'disc_full', 'dns', 'do_not_disturb', 'do_not_disturb_alt', 'dock', 'domain',
            'done_all', 'done_outline', 'donut_large', 'donut_small', 'drafts', 'drag_handle', 'drive_eta', 'dvr',
            'east', 'eco', 'edit_location', 'eject', 'emoji_emotions', 'emoji_events', 'emoji_flags', 'emoji_food_beverage',
            'emoji_nature', 'emoji_objects', 'emoji_people', 'emoji_symbols', 'emoji_transportation', 'enhanced_encryption',
            'equalizer', 'error_outline', 'euro', 'ev_station', 'event_available', 'event_busy', 'event_note', 'event_seat',
            'exit_to_app', 'explore', 'explore_off', 'exposure', 'exposure_neg_1', 'exposure_neg_2', 'exposure_plus_1', 'exposure_plus_2',
            'extension', 'face', 'fact_check', 'fast_rewind', 'favorite_border', 'featured_play_list', 'featured_video', 'feedback',
            'fiber_dvr', 'fiber_manual_record', 'fiber_new', 'fiber_pin', 'fiber_smart_record', 'file_copy', 'file_download', 'file_upload',
            'filter', 'filter_1', 'filter_2', 'filter_3', 'filter_4', 'filter_5', 'filter_6', 'filter_7',
            'filter_8', 'filter_9', 'filter_9_plus', 'filter_alt', 'filter_b_and_w', 'filter_center_focus', 'filter_drama', 'filter_frames',
            'filter_hdr', 'filter_list', 'filter_none', 'filter_tilt_shift', 'filter_vintage', 'find_in_page', 'find_replace', 'fingerprint',
            'fire_extinguisher', 'fireplace', 'first_page', 'flag', 'flare', 'flash_auto', 'flash_off', 'flash_on',
            'flight_land', 'flight_takeoff', 'flip', 'flip_to_back', 'flip_to_front', 'folder_open', 'folder_shared', 'folder_special',
            'font_download', 'format_align_center', 'format_align_justify', 'format_align_left', 'format_align_right', 'format_bold', 'format_clear', 'format_color_fill',
            'format_color_reset', 'format_color_text', 'format_indent_decrease', 'format_indent_increase', 'format_italic', 'format_line_spacing', 'format_list_bulleted', 'format_list_numbered',
            'format_paint', 'format_quote', 'format_shapes', 'format_size', 'format_strikethrough', 'format_textdirection_l_to_r', 'format_textdirection_r_to_l', 'format_underlined',
            'forum', 'forward', 'forward_10', 'forward_30', 'forward_5', 'free_breakfast', 'fullscreen', 'functions',
            'g_translate', 'gamepad', 'games', 'gavel', 'gesture', 'get_app', 'gif', 'golf_course',
            'gps_fixed', 'gps_not_fixed', 'gps_off', 'gradient', 'grading', 'grain', 'graphic_eq', 'grid_off',
            'grid_on', 'group_add', 'group_work', 'hd', 'hdr_off', 'hdr_on', 'hdr_strong', 'hdr_weak',
            'headset', 'headset_mic', 'healing', 'hearing', 'height', 'help_outline', 'high_quality', 'highlight',
            'highlight_off', 'home_work', 'horizontal_split', 'hotel', 'hourglass_empty', 'hourglass_full', 'how_to_reg', 'how_to_vote',
            'http', 'https', 'image_aspect_ratio', 'image_not_supported', 'image_search', 'import_contacts', 'import_export', 'inbox',
            'indeterminate_check_box', 'insert_comment', 'insert_emoticon', 'insert_invitation', 'insert_link', 'insert_photo', 'invert_colors', 'invert_colors_off',
            'iso', 'keyboard_arrow_down', 'keyboard_arrow_left', 'keyboard_arrow_right', 'keyboard_arrow_up', 'keyboard_backspace', 'keyboard_capslock', 'keyboard_hide',
            'keyboard_return', 'keyboard_tab', 'keyboard_voice', 'label', 'label_important', 'label_off', 'label_outline', 'landscape',
            'language', 'last_page', 'launch', 'layers', 'layers_clear', 'leak_add', 'leak_remove', 'lens',
            'library_add', 'library_books', 'library_music', 'linear_scale', 'line_style', 'line_weight', 'list', 'list_alt',
            'live_help', 'live_tv', 'local_activity', 'local_airport', 'local_atm', 'local_drink', 'local_florist', 'local_gas_station',
            'local_grocery_store', 'local_hotel', 'local_laundry_service', 'local_library', 'local_mall', 'local_movies', 'local_parking', 'local_play',
            'local_post_office', 'local_printshop', 'local_see', 'local_shipping', 'location_city', 'location_disabled', 'location_off', 'location_searching',
            'lock_open', 'looks', 'looks_3', 'looks_4', 'looks_5', 'looks_6', 'looks_one', 'looks_two',
            'loyalty', 'mail', 'mail_outline', 'map', 'markunread', 'markunread_mailbox', 'maximize', 'memory',
            'message', 'mic_none', 'mic_off', 'minimize', 'missed_video_call', 'mms', 'mobile_friendly', 'mobile_off',
            'mobile_screen_share', 'mode_comment', 'mode_edit', 'money', 'money_off', 'monochrome_photos', 'mood', 'mood_bad',
            'more', 'more_horiz', 'more_time', 'motion_photos_off', 'motion_photos_on', 'motorcycle', 'mouse', 'move_to_inbox',
            'nature', 'nature_people', 'navigate_before', 'navigate_next', 'navigation', 'near_me', 'network_check', 'network_locked',
            'new_releases', 'next_week', 'nfc', 'nightlight', 'no_encryption', 'no_meeting_room', 'no_sim', 'north',
            'north_east', 'north_west', 'not_interested', 'not_listed_location', 'note', 'note_add', 'notes', 'notification_important',
            'notifications_none', 'notifications_off', 'notifications_paused', 'offline_bolt', 'offline_pin', 'ondemand_video', 'opacity', 'open_in_browser',
            'open_in_full', 'open_in_new', 'open_with', 'outbound', 'pages', 'pageview', 'palette',
            'pan_tool', 'panorama', 'panorama_fish_eye', 'panorama_horizontal', 'panorama_vertical', 'panorama_wide_angle', 'party_mode', 'pause_circle',
            'payment', 'pedal_bike', 'pending',
            'person_pin_circle', 'personal_video', 'pets', 'phone_android', 'phone_bluetooth_speaker', 'phone_callback', 'phone_enabled', 'phone_forwarded',
            'phone_in_talk', 'phone_locked', 'phone_missed', 'phone_paused', 'phonelink', 'phonelink_erase', 'phonelink_lock', 'phonelink_off',
            'phonelink_ring', 'phonelink_setup', 'photo_album', 'photo_camera', 'photo_filter', 'photo_size_select_actual', 'photo_size_select_large', 'photo_size_select_small',
            'picture_as_pdf', 'picture_in_picture', 'picture_in_picture_alt', 'pie_chart_outlined', 'pin_drop', 'place', 'play_circle',
            'play_for_work', 'playlist_add', 'playlist_add_check', 'playlist_play', 'plus_one', 'poll', 'polymer', 'pool',
            'portable_wifi_off', 'portrait', 'post_add', 'power_input', 'power_settings_new', 'pregnant_woman', 'present_to_all', 'priority_high',
            'public', 'publish', 'query_builder', 'question_answer', 'queue', 'queue_music', 'queue_play_next', 'radio',
            'radio_button_checked', 'radio_button_unchecked', 'rate_review', 'receipt', 'recent_actors', 'record_voice_over', 'redeem', 'redo',
            'remove', 'remove_circle', 'remove_circle_outline', 'remove_from_queue', 'remove_red_eye', 'remove_shopping_cart', 'reorder', 'repeat',
            'repeat_one', 'replay', 'replay_10', 'replay_30', 'replay_5', 'reply', 'reply_all', 'report_off',
            'report_problem', 'restaurant_menu', 'restore_from_trash', 'restore_page', 'ring_volume', 'room', 'room_service', 'rotate_90_degrees_ccw',
            'rotate_left', 'rotate_right', 'rounded_corner', 'router', 'rowing', 'rss_feed', 'rv_hookup', 'satellite',
            'save_alt', 'scanner', 'scatter_plot', 'score', 'screen_lock_landscape', 'screen_lock_portrait', 'screen_lock_rotation', 'screen_rotation',
            'screen_share', 'sd_card', 'sd_storage', 'security', 'select_all', 'send', 'sentiment_dissatisfied', 'sentiment_neutral',
            'sentiment_satisfied', 'sentiment_very_dissatisfied', 'sentiment_very_satisfied', 'settings_applications', 'settings_backup_restore', 'settings_bluetooth', 'settings_brightness', 'settings_cell',
            'settings_ethernet', 'settings_input_antenna', 'settings_input_component', 'settings_input_composite', 'settings_input_hdmi', 'settings_input_svideo', 'settings_overscan', 'settings_phone',
            'settings_power', 'settings_remote', 'settings_voice', 'shuffle', 'shutter_speed', 'signal_cellular_4_bar', 'signal_cellular_connected_no_internet_4_bar', 'signal_cellular_no_sim',
            'signal_cellular_null', 'signal_cellular_off', 'signal_wifi_4_bar', 'signal_wifi_4_bar_lock', 'signal_wifi_off', 'sim_card', 'sim_card_alert', 'skip_previous',
            'slideshow', 'slow_motion_video', 'smartphone', 'smoke_free', 'smoking_rooms', 'sms', 'sms_failed', 'snooze',
            'sort', 'sort_by_alpha', 'south', 'south_east', 'south_west', 'speaker', 'speaker_group', 'speaker_notes',
            'speaker_notes_off', 'speaker_phone', 'spellcheck', 'sports', 'sports_baseball', 'sports_basketball', 'sports_cricket', 'sports_esports',
            'sports_football', 'sports_golf', 'sports_handball', 'sports_hockey', 'sports_kabaddi', 'sports_mma', 'sports_motorsports', 'sports_rugby',
            'sports_soccer', 'sports_tennis', 'sports_volleyball', 'star_half', 'star_outline', 'star_rate', 'stars', 'stay_current_landscape',
            'stay_current_portrait', 'stay_primary_landscape', 'stay_primary_portrait', 'stop_screen_share', 'storage', 'store_mall_directory', 'storefront', 'straighten',
            'streetview', 'strikethrough_s', 'style', 'subdirectory_arrow_left', 'subdirectory_arrow_right', 'subject', 'subscriptions', 'subtitles',
            'subway', 'supervised_user_circle', 'supervisor_account', 'surround_sound', 'swap_calls', 'swap_horiz', 'swap_vert', 'swap_vertical_circle',
            'switch_camera', 'switch_video', 'sync_alt', 'sync_disabled', 'sync_problem', 'system_update', 'system_update_alt', 'tab',
            'tab_unselected', 'table_rows', 'tablet_android', 'tablet_mac', 'tag_faces', 'tap_and_play', 'terrain', 'text_fields',
            'text_format', 'text_rotate_up', 'text_rotate_vertical', 'text_rotation_angledown', 'text_rotation_angleup', 'text_rotation_down', 'text_rotation_none', 'textsms',
            'texture', 'theaters', 'thumb_down_alt', 'thumb_up_alt', 'thumbs_up_down', 'timelapse', 'timeline', 'timer',
            'timer_10', 'timer_3', 'timer_off', 'title', 'toc', 'today', 'toggle_off', 'toggle_on',
            'toll', 'tonality', 'touch_app', 'toys', 'track_changes', 'traffic', 'train', 'tram',
            'transfer_within_a_station', 'transform', 'transit_enterexit', 'translate', 'trip_origin', 'tune', 'turned_in', 'turned_in_not',
            'tv', 'unarchive', 'undo', 'unfold_less', 'unfold_more', 'unsubscribe', 'update', 'usb',
            'verified_user', 'vertical_align_bottom', 'vertical_align_center', 'vertical_align_top', 'vertical_split', 'vibration', 'video_call', 'video_label',
            'video_library', 'videocam_off', 'videogame_asset', 'view_agenda', 'view_array', 'view_carousel', 'view_column', 'view_comfy',
            'view_compact', 'view_day', 'view_headline', 'view_list', 'view_module', 'view_quilt', 'view_stream', 'view_week',
            'vignette', 'visibility', 'voice_chat', 'voice_over_off', 'voicemail', 'volume_down', 'volume_mute', 'volume_off',
            'vpn_key', 'vpn_lock', 'wallpaper', 'watch', 'watch_later', 'wb_auto', 'wb_cloudy', 'wb_incandescent',
            'wb_iridescent', 'wb_sunny', 'wc', 'web', 'web_asset', 'weekend', 'west', 'whatshot',
            'wheelchair_pickup', 'where_to_vote', 'widgets', 'wifi_lock', 'wifi_tethering', 'work_off', 'work_outline', 'workspaces',
            'wrap_text', 'youtube_searched_for', 'zoom_out_map'
        ];

        let currentIconName = 'home';
        let currentIconSvg = '';
        let fillType = 'solid';
        let iconStyle = 'outlined';
        let linearDirection = 'diagonal-br'; // デフォルトは対角線（左上→右下）
        let radialType = 'center'; // デフォルトは中央

        // SVGキャッシュ
        const svgCache = {};

        // アイコングリッドに表示
        function renderIcons() {
            const grid = document.getElementById('iconGrid');
            grid.innerHTML = '';

            // スタイルに応じたクラス名を決定
            let iconClass = 'material-symbols-outlined';
            if (iconStyle === 'rounded') {
                iconClass = 'material-symbols-rounded';
            } else if (iconStyle === 'sharp') {
                iconClass = 'material-symbols-sharp';
            } else if (iconStyle === 'filled') {
                iconClass = 'material-symbols-outlined filled';
            }

            materialIcons.forEach(iconName => {
                const item = document.createElement('div');
                item.className = 'icon-item';
                item.onclick = () => selectIcon(iconName);

                item.innerHTML = `
                    <span class="${iconClass}">${iconName}</span>
                    <div class="icon-name">${iconName}</div>
                `;

                grid.appendChild(item);
            });
        }

        // アイコンスタイルを設定
        function setIconStyle(style) {
            iconStyle = style;

            // ボタンの状態を更新
            document.querySelectorAll('[data-style]').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // アイコン一覧を再描画
            renderIcons();

            // 現在のアイコンを再取得
            if (currentIconName) {
                // キャッシュをクリアして再フェッチ
                const cacheKey = `${currentIconName}_${style}`;
                delete svgCache[cacheKey];

                // モーダルが開いている場合は再読み込み
                if (document.getElementById('codeModal').classList.contains('show')) {
                    selectIcon(currentIconName);
                }
            }
        }

        // アイコンのSVGをGoogle Fontsから取得
        async function fetchIconSvg(iconName) {
            // スタイル別のキャッシュキー
            const cacheKey = `${iconName}_${iconStyle}`;

            // キャッシュをチェック
            if (svgCache[cacheKey]) {
                return svgCache[cacheKey];
            }

            try {
                // スタイルに応じたAPIエンドポイントを選択
                let styleEndpoint = 'materialsymbolsoutlined';
                let fillParam = 'default';

                if (iconStyle === 'rounded') {
                    styleEndpoint = 'materialsymbolsrounded';
                } else if (iconStyle === 'sharp') {
                    styleEndpoint = 'materialsymbolssharp';
                } else if (iconStyle === 'filled') {
                    styleEndpoint = 'materialsymbolsoutlined';
                    fillParam = 'fill1';
                }

                // Google Material Symbols APIから取得
                const response = await fetch(`https://fonts.gstatic.com/s/i/short-term/release/${styleEndpoint}/${iconName}/${fillParam}/48px.svg`);
                if (!response.ok) {
                    throw new Error('Icon not found');
                }
                const svgText = await response.text();

                // SVGからpathのd属性を抽出
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgText, 'image/svg+xml');
                const pathElement = svgDoc.querySelector('path');

                if (pathElement) {
                    const pathData = pathElement.getAttribute('d');
                    svgCache[cacheKey] = pathData;
                    return pathData;
                }

                return null;
            } catch (error) {
                console.error(`Failed to fetch icon: ${iconName}`, error);
                return null;
            }
        }

        // アイコン選択
        async function selectIcon(iconName) {
            currentIconName = iconName;

            // 選択状態を更新
            document.querySelectorAll('.icon-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.target.closest('.icon-item').classList.add('selected');

            // SVGデータを取得
            const svgPath = await fetchIconSvg(iconName);
            if (svgPath) {
                currentIconSvg = svgPath;
                // プレビューとコードを更新
                updatePreview();
                // モーダルを表示
                document.getElementById('codeModal').classList.add('show');
            } else {
                alert(`アイコン "${iconName}" のSVGデータを取得できませんでした。\n\nこのアイコンは現在のスタイル (${iconStyle}) では利用できない可能性があります。\n別のスタイルを試してください。`);
            }
        }

        // 塗りタイプを変更
        function setFillType(type) {
            fillType = type;

            // ボタンの状態を更新
            document.querySelectorAll('[data-type]').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // コントロールグループの表示/非表示
            if (type === 'solid') {
                document.getElementById('solidColorGroup').style.display = 'block';
                document.getElementById('gradientColorGroup').style.display = 'none';
                document.getElementById('gradientColorGroup2').style.display = 'none';
                document.getElementById('linearDirectionGroup').style.display = 'none';
                document.getElementById('radialTypeGroup').style.display = 'none';
            } else if (type === 'linear') {
                document.getElementById('solidColorGroup').style.display = 'none';
                document.getElementById('gradientColorGroup').style.display = 'block';
                document.getElementById('gradientColorGroup2').style.display = 'block';
                document.getElementById('linearDirectionGroup').style.display = 'block';
                document.getElementById('radialTypeGroup').style.display = 'none';
            } else if (type === 'radial') {
                document.getElementById('solidColorGroup').style.display = 'none';
                document.getElementById('gradientColorGroup').style.display = 'block';
                document.getElementById('gradientColorGroup2').style.display = 'block';
                document.getElementById('linearDirectionGroup').style.display = 'none';
                document.getElementById('radialTypeGroup').style.display = 'block';
            }

            updatePreview();
        }

        // 線形グラデーション方向を設定
        function setLinearDirection(direction) {
            linearDirection = direction;

            // ボタンの状態を更新
            document.querySelectorAll('[data-direction]').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            updatePreview();
        }

        // 円形グラデーション種類を設定
        function setRadialType(type) {
            radialType = type;

            // ボタンの状態を更新
            document.querySelectorAll('[data-radial]').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            updatePreview();
        }

        // グラデーション座標を取得
        function getLinearGradientCoords(direction) {
            const coords = {
                'to-bottom': { x1: '0%', y1: '0%', x2: '0%', y2: '100%' },
                'to-top': { x1: '0%', y1: '100%', x2: '0%', y2: '0%' },
                'to-right': { x1: '0%', y1: '0%', x2: '100%', y2: '0%' },
                'to-left': { x1: '100%', y1: '0%', x2: '0%', y2: '0%' },
                'diagonal-br': { x1: '0%', y1: '0%', x2: '100%', y2: '100%' }, // 左上→右下
                'diagonal-bl': { x1: '100%', y1: '0%', x2: '0%', y2: '100%' }, // 右上→左下
                'diagonal-tr': { x1: '0%', y1: '100%', x2: '100%', y2: '0%' }, // 左下→右上
                'diagonal-tl': { x1: '100%', y1: '100%', x2: '0%', y2: '0%' }  // 右下→左上
            };
            return coords[direction] || coords['diagonal-br'];
        }

        // 円形グラデーション座標を取得
        function getRadialGradientCoords(type) {
            const coords = {
                'center': { cx: '50%', cy: '50%', r: '50%' },
                'top-left': { cx: '0%', cy: '0%', r: '100%' },
                'top-right': { cx: '100%', cy: '0%', r: '100%' },
                'bottom-left': { cx: '0%', cy: '100%', r: '100%' },
                'bottom-right': { cx: '100%', cy: '100%', r: '100%' }
            };
            return coords[type] || coords['center'];
        }

        // プレビューとコードを更新
        function updatePreview() {
            const previewPath = document.getElementById('previewPath');
            const previewIcon = document.getElementById('previewIcon');
            const svgCode = document.getElementById('svgCode');

            // Null checks to prevent errors when modal is not open
            if (!previewPath || !previewIcon || !svgCode || !currentIconSvg) {
                return;
            }

            // プレビューのパスを更新
            previewPath.setAttribute('d', currentIconSvg);

            let svgString = '';

            if (fillType === 'solid') {
                const color = document.getElementById('solidColor').value;

                // プレビューの色を設定
                previewPath.setAttribute('fill', color);

                // Remove any defs if exists
                const existingDefs = previewIcon.querySelector('defs');
                if (existingDefs) {
                    existingDefs.remove();
                }

                // Power Apps用のSVG生成
                svgString = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 -960 960 960' width='48px' height='48px' fill='${encodeURIComponent(color)}'><path d='${currentIconSvg}'/></svg>`;
            } else {
                const color1 = document.getElementById('gradientColor1').value;
                const color2 = document.getElementById('gradientColor2').value;
                const gradientId = 'grad_' + Date.now();

                // Remove existing defs
                const existingDefs = previewIcon.querySelector('defs');
                if (existingDefs) {
                    existingDefs.remove();
                }

                // Create defs element
                const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                let gradient;

                if (fillType === 'linear') {
                    gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
                    gradient.setAttribute('id', 'preview_grad');

                    const coords = getLinearGradientCoords(linearDirection);
                    gradient.setAttribute('x1', coords.x1);
                    gradient.setAttribute('y1', coords.y1);
                    gradient.setAttribute('x2', coords.x2);
                    gradient.setAttribute('y2', coords.y2);

                    const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
                    stop1.setAttribute('offset', '0%');
                    stop1.setAttribute('style', `stop-color:${color1};stop-opacity:1`);

                    const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
                    stop2.setAttribute('offset', '100%');
                    stop2.setAttribute('style', `stop-color:${color2};stop-opacity:1`);

                    gradient.appendChild(stop1);
                    gradient.appendChild(stop2);
                    defs.appendChild(gradient);
                    previewIcon.insertBefore(defs, previewIcon.firstChild);

                    previewPath.setAttribute('fill', 'url(#preview_grad)');

                    // Power Apps用のSVG生成 - stop-colorを個別属性として指定
                    svgString = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 -960 960 960' width='48px' height='48px'><defs><linearGradient id='${gradientId}' x1='${coords.x1}' y1='${coords.y1}' x2='${coords.x2}' y2='${coords.y2}'><stop offset='0%' stop-color='${color1}' stop-opacity='1'/><stop offset='100%' stop-color='${color2}' stop-opacity='1'/></linearGradient></defs><path d='${currentIconSvg}' fill='url(#${gradientId})'/></svg>`;
                } else if (fillType === 'radial') {
                    gradient = document.createElementNS('http://www.w3.org/2000/svg', 'radialGradient');
                    gradient.setAttribute('id', 'preview_grad');

                    const coords = getRadialGradientCoords(radialType);
                    gradient.setAttribute('cx', coords.cx);
                    gradient.setAttribute('cy', coords.cy);
                    gradient.setAttribute('r', coords.r);

                    const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
                    stop1.setAttribute('offset', '0%');
                    stop1.setAttribute('style', `stop-color:${color1};stop-opacity:1`);

                    const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
                    stop2.setAttribute('offset', '100%');
                    stop2.setAttribute('style', `stop-color:${color2};stop-opacity:1`);

                    gradient.appendChild(stop1);
                    gradient.appendChild(stop2);
                    defs.appendChild(gradient);
                    previewIcon.insertBefore(defs, previewIcon.firstChild);

                    previewPath.setAttribute('fill', 'url(#preview_grad)');

                    // Power Apps用のSVG生成 - stop-colorを個別属性として指定
                    svgString = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 -960 960 960' width='48px' height='48px'><defs><radialGradient id='${gradientId}' cx='${coords.cx}' cy='${coords.cy}' r='${coords.r}'><stop offset='0%' stop-color='${color1}' stop-opacity='1'/><stop offset='100%' stop-color='${color2}' stop-opacity='1'/></radialGradient></defs><path d='${currentIconSvg}' fill='url(#${gradientId})'/></svg>`;
                }
            }

            const powerAppsSvg = `"data:image/svg+xml,"& EncodeUrl("${svgString}")`;
            svgCode.textContent = powerAppsSvg;
        }

        // カラーテキスト入力から更新
        function updateSolidColorFromText() {
            const text = document.getElementById('solidColorText').value;
            document.getElementById('solidColor').value = text;
            updatePreview();
        }

        function updateGradientColor1FromText() {
            const text = document.getElementById('gradientColor1Text').value;
            document.getElementById('gradientColor1').value = text;
            updatePreview();
        }

        function updateGradientColor2FromText() {
            const text = document.getElementById('gradientColor2Text').value;
            document.getElementById('gradientColor2').value = text;
            updatePreview();
        }

        // カラーピッカーから変更時にテキストも更新
        function updateGradientColor1FromPicker() {
            const color = document.getElementById('gradientColor1').value;
            document.getElementById('gradientColor1Text').value = color;
            updatePreview();
        }

        function updateGradientColor2FromPicker() {
            const color = document.getElementById('gradientColor2').value;
            document.getElementById('gradientColor2Text').value = color;
            updatePreview();
        }

        // SVGコードをコピー
        function copySvgCode() {
            const code = document.getElementById('svgCode').textContent;
            const btn = document.getElementById('copySvgBtn');
            const headerBtn = document.getElementById('headerCopySvgBtn');

            navigator.clipboard.writeText(code).then(() => {
                // 両方のボタンを更新
                [btn, headerBtn].forEach(button => {
                    if (button) {
                        const originalText = button.textContent;
                        button.textContent = 'コピー完了!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = originalText;
                            button.classList.remove('copied');
                        }, 2000);
                    }
                });
            });
        }

        // テーマカラーでSVGコードをコピー
        function copySvgCodeWithThemeColor() {
            if (!currentIconSvg) {
                return;
            }

            let svgString = '';

            if (fillType === 'solid') {
                // 単色の場合はfill属性にテーマカラーを設定
                svgString = `<svg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 -960 960 960' width='24px' fill="& JSON(App.Theme.Colors.Primary)&"><path d='${currentIconSvg}'/></svg>`;
            } else {
                // グラデーションの場合は両方の色をテーマカラーに
                const gradientId = 'grad_' + Date.now();

                if (fillType === 'linear') {
                    const coords = getLinearGradientCoords(linearDirection);
                    svgString = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 -960 960 960' width='48px' height='48px'><defs><linearGradient id='${gradientId}' x1='${coords.x1}' y1='${coords.y1}' x2='${coords.x2}' y2='${coords.y2}'><stop offset='0%' stop-color="& JSON(App.Theme.Colors.Primary)&" stop-opacity='1'/><stop offset='100%' stop-color="& JSON(App.Theme.Colors.PrimaryForeground)&" stop-opacity='1'/></linearGradient></defs><path d='${currentIconSvg}' fill='url(#${gradientId})'/></svg>`;
                } else if (fillType === 'radial') {
                    const coords = getRadialGradientCoords(radialType);
                    svgString = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 -960 960 960' width='48px' height='48px'><defs><radialGradient id='${gradientId}' cx='${coords.cx}' cy='${coords.cy}' r='${coords.r}'><stop offset='0%' stop-color="& JSON(App.Theme.Colors.Primary)&" stop-opacity='1'/><stop offset='100%' stop-color="& JSON(App.Theme.Colors.PrimaryForeground)&" stop-opacity='1'/></radialGradient></defs><path d='${currentIconSvg}' fill='url(#${gradientId})'/></svg>`;
                }
            }

            const powerAppsSvg = `"data:image/svg+xml,"& EncodeUrl("${svgString}")`;
            const btn = document.getElementById('copySvgThemeBtn');
            const headerBtn = document.getElementById('headerCopySvgThemeBtn');

            navigator.clipboard.writeText(powerAppsSvg).then(() => {
                // 両方のボタンを更新
                [btn, headerBtn].forEach(button => {
                    if (button) {
                        const originalText = button.textContent;
                        button.textContent = 'コピー完了!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = originalText;
                            button.classList.remove('copied');
                        }, 2000);
                    }
                });
            });
        }

        // モーダルを閉じる
        function closeCodeModal(event) {
            if (!event || event.target.id === 'codeModal') {
                document.getElementById('codeModal').classList.remove('show');
            }
        }

        function showHelp() {
            document.getElementById('helpModal').classList.add('show');
        }

        function closeHelpModal() {
            document.getElementById('helpModal').classList.remove('show');
        }

        // アイコン検索
        function filterIcons() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const items = document.querySelectorAll('.icon-item');

            items.forEach(item => {
                const iconName = item.querySelector('.icon-name').textContent.toLowerCase();
                if (iconName.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // サイドバーのトグル（モバイル用）
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            sidebar.classList.toggle('show');
            overlay.classList.toggle('show');
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            sidebar.classList.remove('show');
            overlay.classList.remove('show');
        }

        // 初期化
        renderIcons();
    </script>
</body>
</html>
